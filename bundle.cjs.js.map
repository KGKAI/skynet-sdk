{"version":3,"file":"bundle.cjs.js","sources":["src/config/index.ts","src/core/requests.ts","src/core/utils.ts","src/core/error.ts","src/index.ts"],"sourcesContent":["export const config = {\n    host: \"http://127.0.0.1:3000\"\n}","import { Data, ErrorData } from \"./data\";\nimport {config} from \"../config/index\"\n/**\n * 使用image上传的依据\n * 1. 只需要发送一个请求就行了，不需要返回\n * 2. 没有跨域问题\n * 3. 不会阻塞页面加载，影响用户的体验，只需new Image对象\n * 4. 不会携带cookie信息\n */\n\nexport function imageRequest(url: string) {\n    const image = new Image(1, 1)\n    image.src = url\n}\n\nexport function getRequestUrl(data: Data, url: string): string {\n    let dataStr = config.host + url + \"/error.gif\" + \"?\"\n    function getDataStr(curData: any) {\n        Object.keys(curData).forEach((key: any) => {\n            if (Object.prototype.toString.call(curData[key]) === \"[object Object]\") {\n                getDataStr(curData[key] as any)\n            } else {\n                dataStr += `${key}=${curData[key]}&`\n            }\n        })\n    }\n\n    getDataStr(data)\n    dataStr = dataStr.substr(0, dataStr.length - 1)\n    return dataStr\n}\n\nexport function upload(data: Data, url: string) {\n    let src = getRequestUrl(data, url)\n    imageRequest(src)\n}","import { DeviceInfo } from './data'\nexport function getPageInfo() {\n\treturn {\n\t\tpageWidth: document.body.clientWidth,\n\t\tpageHeight: document.body.clientHeight,\n\t\tscreenWidth: window.screen.width,\n\t\tscreenHeight: window.screen.height,\n\t};\n}\n\nexport function getBrowserInfo(): any {\n\tconst inBrowser = typeof window !== \"undefined\";\n\tconst ua = inBrowser && window.navigator.userAgent.toLowerCase();\n\tconst isIE = ua && /msie|trident/.test(ua);\n\tconst isEdge = ua && ua.indexOf(\"edge/\") > 0;\n\tconst isChrome = ua && /chrome\\/\\d+/.test(ua) && !isEdge;\n\tconst isOpera = ua && (ua.indexOf(\"opera\") > -1 || ua.indexOf(\"opr\") > -1);\n\tconst isSafari =\n\t\tua && ua.indexOf(\"safari\") > -1 && ua.indexOf(\"chrome\") === -1;\n\tconst isQQ = ua && ua.indexOf(\"mqqbrowser\") > 0;\n\tconst isFF = ua && ua.indexOf(\"firefox\") > -1;\n\tconst isUC = ua && ua.indexOf(\"ucbrowser/\") > 0;\n\tconst isBaidu = ua && ua.indexOf(\"baiduboxapp\") > 0;\n\tconst isAndroid = ua && ua.indexOf(\"android\") > 0;\n\tconst isIOS = ua && /iphone|ipad|ipod|ios/.test(ua);\n\t// 组装数据 省掉 更多的if else的判断\n\tconst BrowserTypeArr = [\n\t\tisIE,\n\t\tisEdge,\n\t\tisChrome,\n\t\tisOpera,\n\t\tisSafari,\n\t\tisQQ,\n\t\tisFF,\n\t\tisUC,\n\t\tisBaidu,\n\t\tisAndroid,\n\t\tisIOS,\n\t];\n\tconst BrowserRetArr = [\n\t\t\"IE\",\n\t\t\"Edge\",\n\t\t\"Chrome\",\n\t\t\"Opera\",\n\t\t\"Safari\",\n\t\t\"QQ\",\n\t\t\"FF\",\n\t\t\"UC\",\n\t\t\"Baidu\",\n\t\t\"Android\",\n\t\t\"IOS\",\n\t].map((val) => {\n\t\treturn {\n\t\t\tbrowserName: val,\n\t\t\tua,\n\t\t};\n\t});\n\n\tconst index: any = BrowserTypeArr.map((val, index) => {\n\t\tif (val) {\n\t\t\treturn index;\n\t\t}\n\t}).filter(Boolean)[0];\n\n\treturn BrowserRetArr[index] ? BrowserRetArr[index] : { browserName: \"unknow\", ua };\n}\n\nexport function getOSInfo() {\n\tlet sUserAgent = navigator.userAgent;\n\tlet isWin =\n\t\tnavigator.platform == \"Win32\" || navigator.platform == \"Windows\";\n\tlet isMac =\n\t\tnavigator.platform == \"Mac68K\" ||\n\t\tnavigator.platform == \"MacPPC\" ||\n\t\tnavigator.platform == \"Macintosh\" ||\n\t\tnavigator.platform == \"MacIntel\";\n\tif (isMac) return \"Mac\";\n\tlet isUnix = navigator.platform == \"X11\" && !isWin && !isMac;\n\tif (isUnix) return \"Unix\";\n\tlet isLinux = String(navigator.platform).indexOf(\"Linux\") > -1;\n\tif (isLinux) return \"Linux\";\n\tif (isWin) {\n\t\tlet isWin2K =\n\t\t\tsUserAgent.indexOf(\"Windows NT 5.0\") > -1 ||\n\t\t\tsUserAgent.indexOf(\"Windows 2000\") > -1;\n\t\tif (isWin2K) return \"Win2000\";\n\t\tlet isWinXP =\n\t\t\tsUserAgent.indexOf(\"Windows NT 5.1\") > -1 ||\n\t\t\tsUserAgent.indexOf(\"Windows XP\") > -1;\n\t\tif (isWinXP) return \"WinXP\";\n\t\tlet isWin2003 =\n\t\t\tsUserAgent.indexOf(\"Windows NT 5.2\") > -1 ||\n\t\t\tsUserAgent.indexOf(\"Windows 2003\") > -1;\n\t\tif (isWin2003) return \"Win2003\";\n\t\tlet isWinVista =\n\t\t\tsUserAgent.indexOf(\"Windows NT 6.0\") > -1 ||\n\t\t\tsUserAgent.indexOf(\"Windows Vista\") > -1;\n\t\tif (isWinVista) return \"WinVista\";\n\t\tlet isWin7 =\n\t\t\tsUserAgent.indexOf(\"Windows NT 6.1\") > -1 ||\n\t\t\tsUserAgent.indexOf(\"Windows 7\") > -1;\n\t\tif (isWin7) return \"Win7\";\n\t\tlet isWin10 =\n\t\t\tsUserAgent.indexOf(\"Windows NT 10\") > -1 ||\n\t\t\tsUserAgent.indexOf(\"Windows 10\") > -1;\n\t\tif (isWin10) return \"Win10\";\n\t}\n\treturn \"other\";\n}\n\nexport function getDeviceInfo() {\n\treturn  {\n\t\tbrowser: getBrowserInfo(),\n\t\tos: getOSInfo(),\n\t};\n}\n","import { ErrorData } from \"./data\";\nimport { upload } from \"./requests\";\nimport { getDeviceInfo, getPageInfo } from \"./utils\";\n\n// 处理运行时异常和资源加载异常\nexport default function error() {\n    window.addEventListener(\"error\", (event: any) => {\n        let params: any, timestamp: number;\n        console.log(event)\n        if (event instanceof ErrorEvent) {  // 运行时错误\n            const {message, lineno, colno, filename, error: {stack}} = event\n            params = {\n                message,\n                lineno,\n                colno,\n                filename,\n                stack\n            }\n        } else {    // 资源加载错误\n            // localName是产生错误的标签元素，如image\n            const {localName, src, href} = event.target\n            let sourceUrl = \"\"\n            // link标签产生的错误是没有src属性的，只有href属性\n            sourceUrl = localName === \"link\" ? href : src\n            params = {\n                resourceType: localName,\n                sourceUrl\n            }            \n        }\n        // 整合数据\n        const data: ErrorData = {\n            uid: \"AAAA\",\n            trackId: \"\",\n            timestamp: +new Date(),\n            deviceInfo: getDeviceInfo(),\n            type: params.resourceType ? \"RESOURCE\" : \"ERROR\",\n            pageInfo: getPageInfo(),\n            currentUrl: window.location.href,\n            refererUrl: document.referrer,\n            data: params\n        }\n        console.log(data)\n        // 上传错误\n        upload(data, \"/monitor/error\")\n    }, true)\n}","import error from \"./core/error\"\nimport promise from \"./core/promise\";\nimport hackRequest from \"./core/hackRequest\"\nimport recordPerformance from \"./core/performance\"\nimport behavior from \"./core/behavior\"\n\nfunction initMonitor() {\n    error()\n    // promise()\n    // hackRequest()\n    // behavior()\n    // 有时关于dom的一些指标和load在加载页面时是拿不到的，所以做一个特殊处理\n    setTimeout(() => {\n        // recordPerformance()\n    }, 2000);\n}\n\ninitMonitor()\n"],"names":[],"mappings":"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"}